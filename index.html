<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Permainan Mines</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px 20px;
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
      min-height: 100vh;
      color: white;
    }

    .container {
      max-width: 600px;
      width: 100%;
      background: rgba(0, 0, 0, 0.7);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    h1 {
      text-align: center;
      font-size: 2.5rem;
      margin-bottom: 20px;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      background: linear-gradient(to right, #ff9966, #ff5e62);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .user-info {
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .user-name {
      font-size: 1.2rem;
      font-weight: bold;
      color: #4CAF50;
    }

    .settings {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .setting-group {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .setting-label {
      font-size: 0.9rem;
      margin-bottom: 5px;
      opacity: 0.8;
    }

    select, input {
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-weight: bold;
      text-align: center;
      width: 120px;
    }

    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type=number] {
      -moz-appearance: textfield;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 25px;
    }

    button {
      padding: 12px 25px;
      font-size: 1rem;
      font-weight: bold;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    #startBtn {
      background: linear-gradient(to right, #00b09b, #96c93d);
      color: white;
    }

    #cashoutBtn {
      background: linear-gradient(to right, #ff9966, #ff5e62);
      color: white;
    }

    button:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
      margin: 30px 0;
    }

    .cell {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(145deg, #6a6a8f, #4a4a6a);
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(255, 255, 255, 0.1);
      font-size: 1.5rem;
    }

    .cell:hover:not(.revealed-safe):not(.revealed-bomb) {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
      background: linear-gradient(145deg, #7a7a9f, #5a5a7a);
    }

    .cell.revealed-safe {
      background: linear-gradient(145deg, #4CAF50, #2E7D32);
      color: white;
      transform: scale(0.95);
    }

    .cell.revealed-bomb {
      background: linear-gradient(145deg, #F44336, #D32F2F);
      color: white;
      transform: scale(0.95);
    }

    .info-panel {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      margin: 20px 0;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .multiplier {
      font-size: 1.8rem;
      font-weight: bold;
      margin-bottom: 15px;
      color: #FFD700;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }

    #message {
      font-size: 1.3rem;
      min-height: 30px;
      font-weight: bold;
      text-align: center;
      margin: 20px 0;
      padding: 15px;
      border-radius: 10px;
      background: rgba(0, 0, 0, 0.3);
    }

    .win {
      color: #4CAF50;
      background: rgba(76, 175, 80, 0.2);
    }

    .lose {
      color: #F44336;
      background: rgba(244, 67, 54, 0.2);
    }

    .stats {
      display: flex;
      justify-content: space-around;
      margin-top: 20px;
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 15px;
    }

    .stat-item {
      text-align: center;
    }

    .stat-value {
      font-size: 1.4rem;
      font-weight: bold;
      color: #FFD700;
    }

    .stat-label {
      font-size: 0.9rem;
      opacity: 0.8;
    }

    .name-input-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      padding: 30px;
    }

    .name-input-container input {
      padding: 12px 20px;
      font-size: 1.2rem;
      width: 80%;
      text-align: center;
    }

    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      padding: 50px 30px;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #4CAF50;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .hidden {
      display: none;
    }

    @media (max-width: 500px) {
      .container {
        padding: 20px 15px;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      .grid {
        gap: 8px;
      }
      
      .cell {
        font-size: 1.2rem;
      }
      
      .settings {
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ’£ Permainan Mines</h1>
    
    <div id="nameInputSection" class="name-input-container">
      <h2>Masukkan Nama Anda</h2>
      <input type="text" id="playerName" placeholder="Nama Anda" maxlength="20">
      <button id="setNameBtn">Mulai Bermain</button>
    </div>
    
    <div id="loadingSection" class="loading hidden">
      <div class="spinner"></div>
      <div id="loadingText">Hi, <span id="loadingName"></span></div>
    </div>
    
    <div id="gameSection" class="hidden">
      <div class="user-info">
        <div class="user-name" id="displayName">Pemain</div>
      </div>
      
      <div class="settings">
        <div class="setting-group">
          <div class="setting-label">Jumlah Bom</div>
          <input type="number" id="bombCount" min="1" max="24" value="5">
        </div>
      </div>
      
      <div class="controls">
        <button id="startBtn">Mulai Permainan</button>
        <button id="cashoutBtn" disabled>Ambil Hadiah</button>
      </div>
      
      <div class="info-panel">
        <div class="multiplier" id="multiplier">Perkalian: x1.00</div>
        <div class="stats">
          <div class="stat-item">
            <div class="stat-value" id="safe-count">0</div>
            <div class="stat-label">Kotak Aman</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="bomb-count">5</div>
            <div class="stat-label">Jumlah Bom</div>
          </div>
        </div>
      </div>
      
      <div id="grid" class="grid"></div>
      
      <div id="message">Masukkan jumlah bom dan klik "Mulai Permainan" untuk memulai!</div>
    </div>
  </div>

  <script>
    const GRID_SIZE = 5;
    let TOTAL_BOMBS = 5;
    let bombs = [];
    let revealed = [];
    let gameOver = false;
    let cashout = false;
    let multiplier = 1.00;
    let safeCount = 0;
    let playerName = "";

    // Elemen-elemen DOM
    const nameInputSection = document.getElementById("nameInputSection");
    const loadingSection = document.getElementById("loadingSection");
    const gameSection = document.getElementById("gameSection");
    const playerNameInput = document.getElementById("playerName");
    const setNameBtn = document.getElementById("setNameBtn");
    const loadingName = document.getElementById("loadingName");
    const displayName = document.getElementById("displayName");
    
    const gridEl = document.getElementById("grid");
    const startBtn = document.getElementById("startBtn");
    const cashoutBtn = document.getElementById("cashoutBtn");
    const multiplierEl = document.getElementById("multiplier");
    const messageEl = document.getElementById("message");
    const safeCountEl = document.getElementById("safe-count");
    const bombCountEl = document.getElementById("bomb-count");
    const bombCountInput = document.getElementById("bombCount");

    // Fungsi untuk mengatur nama pemain
    function setPlayerName() {
      const name = playerNameInput.value.trim();
      if (name) {
        playerName = name;
        loadingName.textContent = playerName;
        
        // Tampilkan loading
        nameInputSection.classList.add("hidden");
        loadingSection.classList.remove("hidden");
        
        // Setelah 2 detik, tampilkan game
        setTimeout(() => {
          loadingSection.classList.add("hidden");
          gameSection.classList.remove("hidden");
          displayName.textContent = playerName;
        }, 2000);
      }
    }

    function generateBombs() {
      const positions = new Set();
      const maxBombs = GRID_SIZE * GRID_SIZE - 1; // Minimal 1 kotak aman
      const bombCount = Math.min(TOTAL_BOMBS, maxBombs);
      TOTAL_BOMBS = bombCount; // Update nilai aktual
      
      while (positions.size < bombCount) {
        positions.add(Math.floor(Math.random() * GRID_SIZE * GRID_SIZE));
      }
      return [...positions];
    }

    function resetGame() {
      TOTAL_BOMBS = parseInt(bombCountInput.value) || 5;
      
      // Validasi jumlah bom
      if (TOTAL_BOMBS < 1) {
        TOTAL_BOMBS = 1;
        bombCountInput.value = 1;
      } else if (TOTAL_BOMBS > 24) {
        TOTAL_BOMBS = 24;
        bombCountInput.value = 24;
      }
      
      bombs = generateBombs();
      revealed = [];
      gameOver = false;
      cashout = false;
      multiplier = 1.00;
      safeCount = 0;
      
      messageEl.textContent = `Permainan dimulai dengan ${TOTAL_BOMBS} bom! Klik kotak aman untuk meningkatkan perkalian.`;
      messageEl.className = "";
      multiplierEl.textContent = "Perkalian: x1.00";
      safeCountEl.textContent = "0";
      bombCountEl.textContent = TOTAL_BOMBS;
      
      cashoutBtn.disabled = false;
      renderGrid();
    }

    function handleCellClick(index) {
      if (revealed.includes(index) || gameOver || cashout) return;
      
      revealed.push(index);
      const cell = document.getElementById("cell-" + index);
      
      if (bombs.includes(index)) {
        cell.classList.add("revealed-bomb");
        cell.textContent = "ðŸ’£";
        gameOver = true;
        messageEl.textContent = "ðŸ’¥ Kamu terkena bom! Permainan Berakhir!";
        messageEl.className = "lose";
        cashoutBtn.disabled = true;
        
        // Tampilkan semua bom
        bombs.forEach(bombIndex => {
          const bombCell = document.getElementById("cell-" + bombIndex);
          if (!bombCell.classList.contains("revealed-bomb")) {
            bombCell.classList.add("revealed-bomb");
            bombCell.textContent = "ðŸ’£";
          }
        });
      } else {
        cell.classList.add("revealed-safe");
        cell.textContent = "âœ…";
        safeCount++;
        safeCountEl.textContent = safeCount;
        
        // Semakin banyak bom, semakin besar perkalian
        const baseMultiplier = 0.2;
        const bombMultiplier = 1 + (TOTAL_BOMBS * 0.1);
        multiplier += baseMultiplier * bombMultiplier;
        multiplier = Math.round(multiplier * 100) / 100;
        multiplierEl.textContent = `Perkalian: x${multiplier.toFixed(2)}`;
        
        // Cek kondisi menang
        if (revealed.length === GRID_SIZE * GRID_SIZE - TOTAL_BOMBS) {
          messageEl.textContent = `ðŸŽ‰ Selamat! Kamu berhasil menyelesaikan permainan! Perkalian akhir: x${multiplier.toFixed(2)}`;
          messageEl.className = "win";
          cashoutBtn.disabled = true;
          gameOver = true;
        }
      }
    }

    function renderGrid() {
      gridEl.innerHTML = "";
      for (let i = 0; i < GRID_SIZE * GRID_SIZE; i++) {
        const div = document.createElement("div");
        div.className = "cell";
        div.id = "cell-" + i;
        div.addEventListener("click", () => handleCellClick(i));
        gridEl.appendChild(div);
      }
    }

    // Event listeners
    setNameBtn.addEventListener("click", setPlayerName);
    
    playerNameInput.addEventListener("keypress", function(e) {
      if (e.key === "Enter") {
        setPlayerName();
      }
    });

    startBtn.addEventListener("click", resetGame);
    cashoutBtn.addEventListener("click", () => {
      if (!gameOver && !cashout) {
        cashout = true;
        messageEl.textContent = `ðŸ’° Kamu mengambil hadiah! Perkalian akhir: x${multiplier.toFixed(2)}`;
        messageEl.className = "win";
        cashoutBtn.disabled = true;
      }
    });
    
    // Validasi input saat diketik
    bombCountInput.addEventListener("input", function() {
      let value = parseInt(this.value) || 0;
      if (value < 1) {
        this.value = 1;
      } else if (value > 24) {
        this.value = 24;
      }
    });
    
    // Inisialisasi grid
    renderGrid();
  </script>
</body>
</html>
